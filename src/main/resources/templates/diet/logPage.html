<html layout:decorate="~{layout-inner}">
    <main layout:fragment="content">
        <section id="title">
            <a href="/user/diet/log"><h3 th:text="${mdUser.nickname != null ? mdUser.nickname : mdUser.username} + '님의 밀땅일지'"></h3></a>
        </section>

        <section id="logs">
            <div class="text-primary text-center pt-20 mb-10">
                <h3>주간 섭취량</h3>
                <span th:text="${#temporals.format(#temporals.createNow().with(T(java.time.temporal.TemporalAdjusters).previousOrSame(T(java.time.DayOfWeek).MONDAY)), 'yyyy.MM.dd')}">이번주 월요일</span>
                <span> - </span>
                <span th:text="${#temporals.format(#temporals.createNow().with(T(java.time.temporal.TemporalAdjusters).nextOrSame(T(java.time.DayOfWeek).SUNDAY)), 'yyyy.MM.dd')}">이번주 일요일</span>
                <table>
                    <tbody>
                        <tr id="kcal">
                            <td>칼로리</td>
                            <td th:text="${totalKcal}"></td>
                            <td>/</td>
                            <td th:text="${md_diet.kcal != null ? md_diet.kcal*7 : '2500*7'}"></td>
                            <td>kcal</td>
                        </tr>
                        <tr id="carbohydrates">
                            <td>탄수화물</td>
                            <td th:text="${totalCarboG}"></td>
                            <td>/</td>
                            <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14*7) : '300.0*7'}"></td>
                            <td>g</td>
                        </tr>
                        <tr id="protein">
                            <td>단백질</td>
                            <td th:text="${totalProteinG}"></td>
                            <td>/</td>
                            <td th:text="${md_diet.protein != null ? md_diet.protein*7 : '40.0*7'}"></td>
                            <td>g</td>
                        </tr>
                        <tr id="fat">
                            <td>지방</td>
                            <td th:text="${totalFatG}"></td>
                            <td>/</td>
                            <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017*7) : '50.0*7'}"></td>
                            <td>g</td>
                        </tr>
                    </tbody>
                </table>
                <a href="/user/diet/weekly"><button class="btn btn-outline-warning">주간 AI 리포트</button></a>
            </div>
        </section>
        <hr>
        <hr>
        <div style="display: flex; align-items: flex-start;">
            <!-- 코드 영역 -->
            <div class="code-area" style="margin-right: 20px;">
            <!-- 오늘 날짜와 이미지 AI 분석 버튼 -->
            <p th:text="'오늘 (' + ${#dates.format(#dates.createNow(), 'yyyy-MM-dd')} + ')'">오늘 날짜</p>
            <a th:href="@{/user/diet/analysis(date=${today})}">
            <button class="btn btn-outline-warning">이미지 AI 분석</button>
            </a>
            <!-- 식단 정보 테이블 -->
            <table>
            <tbody>
                <tr id="kcal">
                <td>칼로리</td>
                <td th:text="${todayKcal}"></td>
                <td>/</td>
                <td th:text="${md_diet.kcal != null ? md_diet.kcal : '2600'}"></td>
                <td>kcal</td>
                </tr>
                <tr id="carbohydrates">
                <td>탄수화물</td>
                <td th:text="${todayCarboG}"></td>
                <td>/</td>
                <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14) : '300.0'}"></td>
                <td>g</td>
                </tr>
                <tr id="protein">
                <td>단백질</td>
                <td th:text="${todayProteinG}"></td>
                <td>/</td>
                <td th:text="${md_diet.protein != null ? md_diet.protein : '55.0'}"></td>
                <td>g</td>
                </tr>
                <tr id="fat">
                <td>지방</td>
                <td th:text="${todayFatG}"></td>
                <td>/</td>
                <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017) : '50.0'}"></td>
                <td>g</td>
                </tr>
            </tbody>
            </table>
        </div>
        
        <!-- 이미지 박스 영역 -->
        <div style="display: flex; justify-content: space-between;">
            <!-- 각 이미지에 대한 반복문 -->
            <th:block th:each="photoPath : ${photoPaths}">
                <div class="image-box" style="flex-grow: 1; margin-right: 10px;">
                    <img th:src="@{'/uploaded/'+${photoPath}}" alt="이미지 설명" style="width: 50%;">
                </div>
            </th:block>
        </div>
        </div>
        
        <!-- 구분선 -->
        <hr>
        <hr>
        <th:block th:each="day : ${#numbers.sequence(0, 6)}">
            <p th:if="${monday != null}" th:text="${monday.plusDays(day)}"></p>
            <!-- 이미지 박스를 추가할 위치 -->
            <div style="display: flex; justify-content: space-around; margin-bottom: 20px;">
                <th:block th:each="eachPhotoPath : ${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'eachPhotoPaths'}__}">
                    <div class="image-box" style="width: 30%;" th:if="${eachPhotoPath != null}">
                        <img th:src="@{'/uploaded/' + ${eachPhotoPath}}" alt="사진 설명" style="width: 50%; height: auto;">
                    </div>
                </th:block>
            </div>
            <!-- 이미지 AI 분석 버튼 -->
            <a th:href="@{/user/diet/analysis(date=${monday.plusDays(day)})}">
                <button class="btn btn-outline-warning">이미지 AI 분석</button>
            </a>
            <!-- 각 날짜별 결과 테이블 -->
            <table>
                <tbody>
                    <tr>
                        <td>칼로리</td>
                        <td th:text="${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'Kcal'}__}"></td>
                        <td>/</td>
                        <td th:text="${md_diet.kcal != null ? md_diet.kcal : '2600'}"></td>
                        <td>kcal</td>
                    </tr>
                    <tr>
                        <td>탄수화물</td>
                        <td th:text="${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'CarboG'}__}"></td>
                        <td>/</td>
                        <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14) : '300.0'}"></td>
                        <td>g</td>
                    </tr>
                    <tr>
                        <td>단백질</td>
                        <td th:text="${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'ProteinG'}__}"></td>

                        <td>/</td>
                        <td th:text="${md_diet.protein != null ? md_diet.protein : '55.0'}"></td>
                        <td>g</td>
                    </tr>
                    <tr>
                        <td>지방</td>
                        <td th:text="${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'FatG'}__}"></td>
                        <td>/</td>
                        <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017) : '50.0'}"></td>
                        <td>g</td>
                    </tr>
                </tbody>
            </table>
            <hr>
        </th:block>
            <hr>
            </div>
        </section>
    </main>
</html>