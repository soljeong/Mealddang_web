<html layout:decorate="~{layout-inner}">
    <main layout:fragment="content">
        <section id="title">
            <a href="/user/diet/log"><h3 th:text="${mdUser.nickname != null ? mdUser.nickname : mdUser.username} + '님의 밀땅일지'"></h3></a>
        </section>

        <section id="logs">
            <div class="text-primary text-center pt-20 mb-10">
                <h3>주간 섭취량</h3>
                <span th:text="${#temporals.format(#temporals.createNow().with(T(java.time.temporal.TemporalAdjusters).previousOrSame(T(java.time.DayOfWeek).MONDAY)), 'yyyy.MM.dd')}">이번주 월요일</span>
                <span> - </span>
                <span th:text="${#temporals.format(#temporals.createNow().with(T(java.time.temporal.TemporalAdjusters).nextOrSame(T(java.time.DayOfWeek).SUNDAY)), 'yyyy.MM.dd')}">이번주 일요일</span>

                <table>
                    <tbody>
                        <tr id="kcal">
                            <td>칼로리</td>
                            <td>100</td>
                            <td>/</td>
                            <td th:text="${md_diet.kcal != null ? md_diet.kcal*7 : '2500*7'}"></td>
                            <td>kcal</td>
                        </tr>
                        <tr id="carbohydrates">
                            <td>탄수화물</td>
                            <td>100</td>
                            <td>/</td>
                            <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14*7) : '300.0*7'}"></td>
                            <td>g</td>
                        </tr>
                        <tr id="protein">
                            <td>단백질</td>
                            <td>15</td>
                            <td>/</td>
                            <td th:text="${md_diet.protein != null ? md_diet.protein*7 : '40.0*7'}"></td>
                            <td>g</td>
                        </tr>
                        <tr id="fat">
                            <td>지방</td>
                            <td>10</td>
                            <td>/</td>
                            <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017*7) : '50.0*7'}"></td>
                            <td>g</td>
                        </tr>
                    </tbody>
                </table>

                <a href="/user/diet/weekly"><button>주간 AI 리포트</button></a>
            </div>
        </section>
        <hr>
        <hr>

            <section id="logs">
                <div class="text-primary pt-20 mb-10">
                    <p th:text="'오늘 (' + ${#dates.format(#dates.createNow(), 'yyyy-MM-dd')} + ')'">오늘 날짜</p>
                    <a th:href="@{/user/diet/analysis(date=${today})}">
                        <button>이미지 AI 분석</button>
                    </a>    
                    <table>
                        <tbody>
                            <tr id="kcal">
                                <td>칼로리</td>
                                <td th:text="${firstResult != null ? (firstResult.kcal != null ? firstResult.kcal : 'N/A') : '0'}">
                                <td>/</td>
                                <td th:text="${md_diet.kcal != null ? md_diet.kcal : '2600'}"></td>
                                <td>kcal</td>
                            </tr>
                            <tr id="carbohydrates">
                                <td>탄수화물</td>
                                <td th:text="${firstResult != null ? (firstResult.carboG != null ? firstResult.carboG : 'N/A') : '0'}">Carbohydrates</td>
                                <td>/</td>
                                <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14) : '300.0'}"></td>
                                <td>g</td>
                            </tr>
                        <tr id="protein">
                            <td>단백질</td>
                            <td th:text="${proteing}">Protein</td>
                            <td>/</td>
                            <td th:text="${md_diet.protein != null ? md_diet.protein : '55.0'}"></td>
                            <td>g</td>
                        </tr>
                        <tr id="fat">
                            <td>지방</td>
                            <td>
                                <span th:if="${fatg != null}" th:text="${fatg}">Fat</span>
                                <span th:if="${fatg == null}">0</span>
                            </td>
                            <td>/</td>
                            <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017) : '50.0'}"></td>
                            <td>g</td>
                        </tr>
                    </tbody>
                </table>
                <hr>
                <hr>

                <!--<h6 th:text="${#temporals.format(T(java.time.LocalDate).now(), 'yyyy.MM.dd')}">오늘 날짜 22</h6>-->
                <th:block th:each="day : ${#numbers.sequence(0, 6)}">
                    <p th:if="${monday != null}" th:text="${monday.plusDays(day)}"></p>
                    <a th:href="@{/user/diet/analysis(date=${monday.plusDays(day)})}">
                        <button>이미지 AI 분석</button>
                    </a>
                    <table>
                        <tbody>
                            <th:block th:each="result : ${results}">
                                <tr th:if="${result.createdDate.equals(monday.plusDays(day))}">
                                    <td>칼로리</td>
                                    <td th:text="${result.kcal != null ? result.kcal : 0}"></td>
                                    <td>/</td>
                                    <td th:text="${md_diet.kcal != null ? md_diet.kcal : '2600'}"></td>
                                    <td>kcal</td>
                                </tr>
                                <tr th:if="${result.createdDate.equals(monday.plusDays(day))}">
                                    <td>탄수화물</td>
                                    <td th:text="${result.carboG != null ? result.carboG : 0}"></td>
                                    <td>/</td>
                                    <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14) : '300.0'}"></td>
                                    <td>g</td>
                                </tr>
                                <tr th:if="${result.createdDate.equals(monday.plusDays(day))}">
                                    <td>단백질</td>
                                    <td th:text="${result.proteinG != null ? result.proteinG : 0}"></td>
                                    <td>/</td>
                                    <td th:text="${md_diet.protein != null ? md_diet.protein : '55.0'}"></td>
                                    <td>g</td>
                                </tr>
                                <tr th:if="${result.createdDate.equals(monday.plusDays(day))}">
                                    <td>지방</td>
                                    <td th:text="${result.fatG != null ? result.fatG : 0}"></td>
                                    <td>/</td>
                                    <td th:text="${md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017) : '50.0'}"></td>
                                    <td>g</td>
                                </tr>
                            </th:block>
                        </tbody>
                    </table>
                    <hr>
                </th:block>
                <hr>
            </div>
        </section>
    </main>
</html>