<html layout:decorate="~{layout-inner}">
    <main class="container" layout:fragment="content">
        <!-- 제목 섹션 -->
        <section id="title">
            <a href="/user/diet/log"><h3 th:text="${mdUser.nickname != null ? mdUser.nickname : mdUser.username} + '님의 밀땅일지'"></h3></a>
        </section>

        <!-- 슬라이드 섹션 -->
        <section class="container yellow-border">
            <div class="text-center">
                <h3 style="color: black;">주간 섭취량</h3>
                <div class="date-navigation">
                    <button id="prev" class="btn btn-outline-warning"> < </button>
                        <div class="date-center">
                            <div class="text-primary text-center">
                                <a href="/user/diet/weekly" style="margin-left: auto;">
                                    <button class="btn btn-outline-warning">주간 AI 리포트</button></a>
                            </div>
                        </div>
                    <button id="next" class="btn btn-outline-warning"> > </button>
                </div>
                <div id="slider">
                    <!-- 슬라이드 내용이 들어갈 곳 -->
                    <div class="slide" id="lastWeek">
                        저번주 내용
                        <div class="date-center">
                            <span th:text="${#temporals.format(#temporals.createNow().with(T(java.time.temporal.TemporalAdjusters).previousOrSame(T(java.time.DayOfWeek).MONDAY)), 'yyyy.MM.dd')}">이번주 월요일</span>
                            <span> - </span>
                            <span th:text="${#temporals.format(#temporals.createNow().with(T(java.time.temporal.TemporalAdjusters).nextOrSame(T(java.time.DayOfWeek).SUNDAY)), 'yyyy.MM.dd')}">이번주 일요일</span>
                        </div>
                        <table style="margin: 0 auto;">
                            <tbody>
                                <tr id="totalkcal">
                                    <td colspan="2" style="text-align: left;">칼로리</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${totalKcal + ' / ' + (md_diet.kcal != null ? md_diet.kcal*7 : '2500*7') + ' kacl'}"> </span>
                                    </td>
                                </tr>
                                <tr id="totalcarbohydrates">
                                    <td colspan="2" style="text-align: left;">탄수화물</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${totalCarboG + ' / ' + (md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14*7) : '300.0*7')+ ' g'} "> </span>
                                    </td>
                                </tr>
                                <tr id="totalprotein">
                                    <td colspan="2" style="text-align: left;">단백질</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${totalProteinG + ' / ' + (md_diet.protein != null ? md_diet.protein*7 : '40.0*7')+ ' g'} "> </span>
                                    </td>
                                </tr>
                                <tr id="totalfat">
                                    <td colspan="2" style="text-align: left;">지방</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${totalFatG + ' / ' + (md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017*7) : '50.0*7')+ ' g'} "> </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="slide" id="thisWeek" style="display:none;">
                        이번주 내용
                        <div class="date-center">
                            <span th:text="${#temporals.format(#temporals.createNow().with(T(java.time.temporal.TemporalAdjusters).previousOrSame(T(java.time.DayOfWeek).MONDAY)), 'yyyy.MM.dd')}">이번주 월요일</span>
                            <span> - </span>
                            <span th:text="${#temporals.format(#temporals.createNow().with(T(java.time.temporal.TemporalAdjusters).nextOrSame(T(java.time.DayOfWeek).SUNDAY)), 'yyyy.MM.dd')}">이번주 일요일</span>
                        </div>
                        <table style="margin: 0 auto;">
                            <tbody>
                                <tr id="totalkcal">
                                    <td colspan="2" style="text-align: left;">칼로리</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${totalKcal + ' / ' + (md_diet.kcal != null ? md_diet.kcal*7 : '2500*7') + ' kacl'}"> </span>
                                    </td>
                                </tr>
                                <tr id="totalcarbohydrates">
                                    <td colspan="2" style="text-align: left;">탄수화물</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${totalCarboG + ' / ' + (md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14*7) : '300.0*7')+ ' g'} "> </span>
                                    </td>
                                </tr>
                                <tr id="totalprotein">
                                    <td colspan="2" style="text-align: left;">단백질</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${totalProteinG + ' / ' + (md_diet.protein != null ? md_diet.protein*7 : '40.0*7')+ ' g'} "> </span>
                                    </td>
                                </tr>
                                <tr id="totalfat">
                                    <td colspan="2" style="text-align: left;">지방</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${totalFatG + ' / ' + (md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017*7) : '50.0*7')+ ' g'} "> </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        

        <!-- 오늘 내용 섹션 -->
        <section class="container yellow-border">
            <div class="row">
                <!-- 제목 부분 -->
                <div class="col-md-12">
                    <div class="code-area" style="margin-right: 20px; display: flex; justify-content: flex-end;">
                        <p th:text="'오늘 (' + ${#dates.format(#dates.createNow(), 'yyyy-MM-dd')} + ')'">오늘 날짜</p>
                        <a th:href="@{/user/diet/analysis(date=${today})}" style="margin-left: auto;">
                            <button class="btn btn-outline-warning">이미지 AI 분석</button>
                        </a>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- 테이블 데이터 -->
                <div class="col-md-3">
                    <table class="table">
                        <tbody>
                            <tr id="todaykcal">
                                <td colspan="2" style="text-align: left;">칼로리</td>
                                <td colspan="3" style="text-align: right;">
                                    <span th:text="${todayKcal + ' / ' + (md_diet.kcal != null ? md_diet.kcal : '2600') + ' kacl'}"> </span>
                                </td>
                            </tr>
                            <tr id="todaycarbohydrates">
                                <td colspan="2" style="text-align: left;">탄수화물</td>
                                <td colspan="3" style="text-align: right;">
                                    <span th:text="${todayCarboG + ' / ' + (md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14) : '300.0')+ ' g'} "> </span>
                                </td>
                            </tr>
                            <tr id="todayprotein">
                                <td colspan="2" style="text-align: left;">단백질</td>
                                <td colspan="3" style="text-align: right;">
                                    <span th:text="${todayProteinG + ' / ' + (md_diet.protein != null ? md_diet.protein : '55.0')+ ' g'} "> </span>
                                </td>
                            </tr>
                            <tr id="todayfat">
                                <td colspan="2" style="text-align: left;">지방</td>
                                <td colspan="3" style="text-align: right;">
                                    <span th:text="${todayFatG + ' / ' + (md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017) : '50.0')+ ' g'} "> </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- 사진 데이터 -->
                <div class="col-md-9">
                    <!-- 이미지 박스 영역 -->
                    <div class="image-box-wrapper">
                        <!-- 각 이미지에 대한 반복문 -->
                        <div th:each="photoPath : ${photoPaths}" class="image-box">
                            <a th:href="|http://localhost:8080/user/diet/airesult?originPath=${photoPath}|">
                                <img th:src="@{'/uploaded/'+${photoPath}}" th:alt="${photoPath}">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 구분선 -->
        </section>

        <!-- 이번주 내용 섹션 -->
        <th:block th:each="day : ${#numbers.sequence(0, 6)}">
            <section class="container">
                <div class="row">
                    <!-- 제목 부분 -->
                    <div class="col-md-12">
                        <div class="code-area" style="margin-right: 20px; display: flex; justify-content: flex-end;">
                            <p th:if="${monday != null}" th:text="${monday.plusDays(day)}"></p>
                            <a th:href="@{/user/diet/analysis(date=${monday.plusDays(day)})}" style="margin-left: auto;">
                                <button class="btn btn-outline-warning">이미지 AI 분석</button>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!-- 테이블 데이터 -->
                    <div class="col-md-3">
                        <table class="table">
                            <tbody>
                                <tr id="todaykcal">
                                    <td colspan="2" style="text-align: left;">칼로리</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'Kcal'}__ + ' / ' + (md_diet.kcal != null ? md_diet.kcal : '2600')+ ' kacl'}"></span>
                                    </td>
                                </tr>
                                <tr id="todaycarbohydrates">
                                    <td colspan="2" style="text-align: left;">탄수화물</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'CarboG'}__ + ' / ' + (md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.14) : '300.0')+ ' g'} "> </span>
                                    </td>
                                </tr>
                                <tr id="todayprotein">
                                    <td colspan="2" style="text-align: left;">단백질</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'ProteinG'}__ + ' / ' + (md_diet.protein != null ? md_diet.protein : '55.0')+ ' g'} "></span>
                                    </td>
                                </tr>
                                <tr id="todayfat">
                                    <td colspan="2" style="text-align: left;">지방</td>
                                    <td colspan="3" style="text-align: right;">
                                        <span th:text="${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'FatG'}__ + ' / ' + (md_diet.kcal != null ? T(java.lang.String).format('%1$.1f', (md_diet.kcal)*0.017) : '50.0')+ ' g'} "> </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- 사진 데이터 -->
                    <div class="col-md-9">
                        <div class="image-box-wrapper">
                            <div th:each="eachPhotoPath : ${__${monday.plusDays(day).getDayOfWeek().toString().toLowerCase() + 'eachPhotoPaths'}__}">
                                <div class="image-box" th:if="${eachPhotoPath != null}">
                                    <img th:src="@{'/uploaded/' + ${eachPhotoPath}}" alt="${eachPhotoPath}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 구분선 -->
                <hr>
                <hr>
            </section>
        </th:block>
    </main>
</html>

