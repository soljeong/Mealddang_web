<html layout:decorate="~{layout-inner}">
    <main layout:fragment="content">

        <!-- ê²€ìƒ‰ì°½ section -->
        <section id="search-box">
            <div class="nemonemo">
            <h2 class="title">ğŸ½ï¸ ì‹ë‹¹ ê²€ìƒ‰ ğŸ½ï¸</h2>
            <form action="/user/rsrt/search/name" method="GET">
                <input onkeyup="enterkey()" type="search" name="searchkey" placeholder="ì‹ë‹¹ ì´ë¦„ ê²€ìƒ‰"/>
                <button type="submit" class="btn btn-outline-warning">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
            </form>
        </div>
        </section>

        <!-- ê²€ìƒ‰ ë° í•„í„° ê²°ê³¼ section -->
        <section id="map-result">
            <div class="searchresult" style="display: none;">
                <div th:if="${(nameSearchResults == null || nameSearchResults.isEmpty()) && storeCnt == 0}">
                    <span>0ê±´ì˜ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.</span>
                </div>
                <div th:if="${!(nameSearchResults == null || nameSearchResults.isEmpty())}">
                    <span th:text="${#lists.size(nameSearchResults)} + 'ê±´ì˜ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.'" style="display:inline-block;"></span>
                </div>
                <div th:if="${storeCnt > 0}">
                    <span th:text="${storeCnt} + 'ê±´ì˜ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.'" style="display:inline-block;"></span>
                </div>
                
                <!-- <table>
                        <tbody class="searchResultTable">
                            <tr th:id="${mdStore.storeId}" th:each="mdStore : ${nameSearchResults}" class="table-row">
                                <td class="table-data" th:text="${mdStore.storeName != null ? mdStore.storeName : 'N/A'}" style="display: none;"></td>
                                <td class="table-data" th:text="${mdStore.storeAddr != null ? mdStore.storeAddr : 'N/A'}" style="display: none;"></td>
                            </tr>
                        </tbody>
                    </table> -->

                <script>
                    document.querySelector('.searchresult').style.display = 'block';
                </script>
            </div>
        </section>

        <!-- í‚¤ì›Œë“œ ì¹´í…Œê³ ë¦¬ í•„í„° section -->
        <section id="category-filter">
            <div class="nemonemo">
            <div class="category-container" style="margin-bottom: 20px;">
                <h2 class="category-title" style="margin:20px 0;">ğŸ’› ë°€ë•… ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ë³´ì„¸ìš” ğŸ’›</h2>

                <div class="category-list button-con">
                    <button class="activebtn btn btn-outline-warning"style="margin-bottom: 10px;" id="atmosphereButton" data-value="ë¶„ìœ„ê¸°">ë¶„ìœ„ê¸°</button>
                    <script>
                        document.getElementById("atmosphereButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ğŸŒŸë¶„ìœ„ê¸°"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>
                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="tasteButton" data-value="ë§›">ë§›ìˆëŠ”</button>
                    <script>
                        document.getElementById("tasteButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ğŸ‘…ë§›"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>
                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="cleanButton" data-value="ê¹¨ë—">ê¹”ë”í•œ</button>
                    <script>
                        document.getElementById("cleanButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("âœ¨ê¹¨ë—"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="cleanlinessButton" data-value="ì²­ê²°">ì²­ê²°</button>
                    <script>
                        document.getElementById("cleanlinessButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ğŸ´ì²­ê²°"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="bookButton"data-value="ì˜ˆì•½">ì˜ˆì•½ê°€ëŠ¥</button>
                    <script>
                        document.getElementById("bookButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ğŸ““ì˜ˆì•½"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="bigButton"data-value="ëŒ€í˜•">ëŒ€í˜•ë§¤ì¥</button>
                    <script>
                        document.getElementById("bigButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ğŸ•ëŒ€í˜•"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="diningButton" data-value="íšŒì‹">íšŒì‹</button>
                    <script>
                        document.getElementById("diningButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("íšŒì‹"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>
                    
                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="notaloneButton" data-value="í˜¼ë°¥">í˜¼ë°¥</button>
                    <script>
                        document.getElementById("notaloneButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("í˜¼ë°¥"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="dateButton" data-value="ë°ì´íŠ¸">ë°ì´íŠ¸</button>
                    <script>
                        document.getElementById("dateButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ë°ì´íŠ¸"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="familyButton" data-value="ê°€ì¡±">ê°€ì¡±ëª¨ì„</button>
                    <script>
                        document.getElementById("familyButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ê°€ì¡±"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="groupButton" data-value="ë‹¨ì²´">ë‹¨ì²´ì„</button>
                    <script>
                        document.getElementById("groupButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ë‹¨ì²´"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="roomButton" data-value="ë£¸">ë£¸</button>
                    <script>
                        document.getElementById("roomButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ë£¸"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="privateButton" data-value="í”„ë¼ì´ë¹—">í”„ë¼ì´ë¹—</button>
                    <script>
                        document.getElementById("privateButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("í”„ë¼ì´ë¹—"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;"id="parkButton" data-value="ì£¼ì°¨ì¥">ì£¼ì°¨</button>
                    <script>
                        document.getElementById("parkButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ì£¼ì°¨ì¥"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="coolButton" data-value="ì½œí‚¤ì§€í”„ë¦¬">ì½œí‚¤ì§€í”„ë¦¬</button>
                    <script>
                        document.getElementById("coolButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ì½œí‚¤ì§€í”„ë¦¬"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="traditionButton" data-value="ì „í†µ">ì „í†µ</button>
                    <script>
                        document.getElementById("traditionButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ì „í†µ"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="deliveryButton" data-value="ë°°ë‹¬">ë°°ë‹¬</button>
                    <script>
                        document.getElementById("deliveryButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ë°°ë‹¬"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="packagingButton" data-value="í¬ì¥">í¬ì¥</button>
                    <script>
                        document.getElementById("packagingButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("í¬ì¥"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="dawnButton" data-value="ìƒˆë²½">ìƒˆë²½</button>
                    <script>
                        document.getElementById("dawnButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ìƒˆë²½"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="noholidayButton" data-value="ì—°ì¤‘ë¬´íœ´">ì—°ì¤‘ë¬´íœ´</button>
                    <script>
                        document.getElementById("noholidayButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ì—°ì¤‘ë¬´íœ´"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="petButton" data-value="ë°˜ë ¤ë™ë¬¼">ë°˜ë ¤ë™ë¬¼</button>
                    <script>
                        document.getElementById("petButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ë°˜ë ¤ë™ë¬¼"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>

                    <button class="activebtn btn btn-outline-warning" style="margin-bottom: 10px;" id="newButton" data-value="ìƒˆë¡œ">ìƒˆë¡œì˜¤í”ˆ</button>
                    <script>
                        document.getElementById("newButton").addEventListener("click", function() {
                            var keyword = encodeURIComponent("ìƒˆë¡œ"); // URLì— ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í‚¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                            window.location.href = '/user/rsrt/filter/atmosphere?keyword=' + keyword;
                        });
                    </script>
                </div>
            </div>
        </section>

        <!-- ì§€ë„ section -->
        <section id="map">
            <div class="map-container">
                <div class="map" style="width:70%; height:500px; right: -250px;"></div>

                <!-- <div class="img-search"><h5>ì´ë¯¸ì§€ ê²€ìƒ‰</h5></div> -->
                
                <!-- ì±—ë´‡ ì½”ë“œ ì¶”ê°€
                <div id="chatbot" style="position: fixed; bottom: 20px; right: 20px; width: 300px; height: 400px; border: 1px solid #ccc; background-color: #f9f9f9; overflow-y: auto;">
                    <div id="chatbot-messages" style="padding: 10px;"></div>
                    <input type="text" id="chatbot-input" style="width: 100%; padding: 5px; box-sizing: border-box; border: 1px solid #ccc;">
                </div>
                <script>
                    // ì±—ë´‡ ë©”ì‹œì§€ë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
                    function addMessage(message, isUser) {
                        var chatbotMessages = document.getElementById('chatbot-messages');
                        var div = document.createElement('div');
                        div.textContent = message;
                        if (isUser) {
                            div.style.textAlign = 'right';
                            div.style.color = 'blue';
                        }
                        chatbotMessages.appendChild(div);
                        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
                    }
                
                    // ì±—ë´‡ ì…ë ¥ ì´ë²¤íŠ¸ ì²˜ë¦¬
                    document.getElementById('chatbot-input').addEventListener('keypress', function(event) {
                        if (event.key === 'Enter') {
                            var input = event.target.value;
                            addMessage('ì‚¬ìš©ì: ' + input, true); // ì‚¬ìš©ì ì…ë ¥ ì¶”ê°€
                            // ì—¬ê¸°ì— ì…ë ¥ëœ ë©”ì‹œì§€ì— ë”°ë¥¸ ì±—ë´‡ ì‘ë‹µì„ ì¶”ê°€í•˜ëŠ” ë¡œì§ì„ ì‘ì„±
                            // ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ì ì…ë ¥ì´ 'ì•ˆë…•'ì´ë©´ ì±—ë´‡ì´ 'ì•ˆë…•í•˜ì„¸ìš”!'ì™€ ê°™ì€ ì‘ë‹µì„ ìƒì„±í•˜ì—¬ ì¶”ê°€
                            event.target.value = ''; // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                        }
                    });
                </script> -->
            </div>
        </section>
        </div>

        <script th:inline="javascript">
            var infowindow = new naver.maps.InfoWindow();

            var nameSearchResults = /*[[${nameSearchResults}]]*/ {}; 
            console.log(nameSearchResults);
            var filteredStores = /*[[${filteredStores}]]*/ {}; 
            console.log(filteredStores);

            // ì§€ë„ ìƒì„±
            var map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(37.498095, 127.027610), // ê°•ë‚¨ì—­ ì¤‘ì‹¬ìœ¼ë¡œ í•˜ëŠ” ì§€ë„
                zoom: 13
            });

            if (nameSearchResults){
                // nameSearchResultsì— ëŒ€í•œ ë§ˆì»¤ ìƒì„±
                nameSearchResults.forEach(function(store) {
                    var marker = new naver.maps.Marker({
                        position: new naver.maps.LatLng(store.storeY, store.storeX),
                        map: map
                    });
                    
                    var contentString = [
                        '<div class="iw_inner">',
                        '   <h3>' + store.storeName + '</h3>',
                        '   <p>' + store.storeAddr + '<br />',
                        '       <img src="' + store.storeImgUrl + '" width="55" height="55" alt="' + store.storeName + '" class="thumb" /><br />',
                        '       ' + store.storeTel + ' | <button class="btn btn-outline-warning" onclick="window.open(\'' + store.storeMenuUrlN + '\', \'_blank\')">ë©”ë‰´ ë³´ê¸°</button>',
                        '   </p>',
                        '</div>'
                    ].join('');

                    var infowindow = new naver.maps.InfoWindow({
                        content: contentString,
                        maxWidth: 300,
                        backgroundColor: "lightyellow", // ì—°ë…¸ë‘ìƒ‰ ë°°ê²½
                        borderColor: "#ffc107", // ë…¸ë€ìƒ‰ í…Œë‘ë¦¬
                        borderWidth: 3,
                        anchorSize: new naver.maps.Size(30, 30),
                        anchorSkew: true,
                        anchorColor: "lightyellow", // ì—°ë…¸ë‘ìƒ‰ ì•µì»¤
                        pixelOffset: new naver.maps.Point(20, -20)
                    });
            
                    naver.maps.Event.addListener(marker, 'click', function(e) {
                        if (infowindow.getMap()) {
                            infowindow.close();
                        } else {
                            infowindow.setContent(contentString);
                            infowindow.open(map, marker);
                        }
                    });
                });
            }

            if(filteredStores){
                // filteredStoresì— ëŒ€í•œ ë§ˆì»¤ ìƒì„±
                filteredStores.forEach(function(store) {
                    var marker = new naver.maps.Marker({
                        position: new naver.maps.LatLng(store.storeY, store.storeX),
                        map: map
                    });
                    
                    var contentString = [
                        '<div class="iw_inner">',
                        '   <h3>' + store.storeName + '</h3>',
                        '   <p>' + store.storeRoadAddressN + '<br />',
                        '       <img src="' + store.storeImageUrl + '" width="55" height="55" alt="' + store.storeName + '" class="thumb" /><br />',
                        '       ' + store.storePhone + ' | <button class="btn btn-outline-warning" onclick="window.open(\'' + store.storeMenuUrlN + '\', \'_blank\')">ë©”ë‰´ ë³´ê¸°</button>',
                        '   </p>',
                        '</div>'
                    ].join('');

                    var infowindow = new naver.maps.InfoWindow({
                        content: contentString,
                        maxWidth: 300,
                        backgroundColor: "lightyellow", // ì—°ë…¸ë‘ìƒ‰ ë°°ê²½
                        borderColor: "#ffc107", // ë…¸ë€ìƒ‰ í…Œë‘ë¦¬
                        borderWidth: 3,
                        anchorSize: new naver.maps.Size(30, 30),
                        anchorSkew: true,
                        anchorColor: "lightyellow", // ì—°ë…¸ë‘ìƒ‰ ì•µì»¤
                        pixelOffset: new naver.maps.Point(20, -20)
                    });
                    // ì •ë³´ ì°½ ë‚´ìš© ì„¤ì • í›„ ì—´ê¸°
                    naver.maps.Event.addListener(marker, 'click', function(e) {
                        if (infowindow.getMap()) {
                            infowindow.close();
                        } else {
                            infowindow.setContent(contentString);
                            infowindow.open(map, marker);
                        }
                    });
                }); 
                // ê²€ìƒ‰ì°½ ì—”í„°í‚¤ ì´ë²¤íŠ¸
                function enterkey() {
                    if (window.event.keyCode == 13) {
                        document.getElementById("searchForm").submit();
                    }
                    return false
                }
            }

            //ì‹¤ì‹œê°„ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
            var currentMarker = null; // í˜„ì¬ ë§ˆì»¤ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
            var lastPosition = null; // ë§ˆì§€ë§‰ ìœ„ì¹˜ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
            var isFirstLocation = true; // ì²« ë²ˆì§¸ ìœ„ì¹˜ í™•ì¸ì¸ì§€ ì—¬ë¶€ë¥¼ ì €ì¥í•  ë³€ìˆ˜

            setInterval(function() {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;
            
                // ìƒˆ ìœ„ì¹˜ì™€ ë§ˆì§€ë§‰ ìœ„ì¹˜ë¥¼ ë¹„êµ
                if (lastPosition && latitude === lastPosition.lat && longitude === lastPosition.lng) {
                    // ìœ„ì¹˜ê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
                    return;
                }

                // ìƒˆ ìœ„ì¹˜ë¥¼ ë§ˆì§€ë§‰ ìœ„ì¹˜ë¡œ ì—…ë°ì´íŠ¸
                lastPosition = { lat: latitude, lng: longitude };

                // ì´ì „ ë§ˆì»¤ê°€ ìˆìœ¼ë©´ ì§€ë„ì—ì„œ ì œê±°
                if (currentMarker) {
                    currentMarker.setMap(null);
                }

                // var markerOptions = {
                //     position: new naver.maps.LatLng(latitude, longitude),
                //     map: map,
                //     icon: {
                //         content: '<img src="/static/icons/map-marker-icon_34392.png" style="width: 33px; height: 33px;">'
                //     } // ë¹¨ê°„ìƒ‰ ë§ˆì»¤ ì´ë¯¸ì§€ë¡œ ì„¤ì •
                // };

                var markerOptions = {
                    position: new naver.maps.LatLng(latitude, longitude),
                    map: map,
                    icon: {
                        url: '/icons/map-marker-icon_34392.png', // ì´ë¯¸ì§€ì˜ ê²½ë¡œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
                        size: new naver.maps.Size(33, 33), // ì´ë¯¸ì§€ì˜ í¬ê¸°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
                        scaledSize: new naver.maps.Size(33, 33) // ì´ë¯¸ì§€ì˜ í¬ê¸°ë¥¼ í™”ë©´ì— í‘œì‹œë  í¬ê¸°ë¡œ ì¡°ì ˆí•©ë‹ˆë‹¤.
                    }
                };
                var marker = new naver.maps.Marker(markerOptions);
                
                // ìƒˆë¡œ ìƒì„±ëœ ë§ˆì»¤ë¥¼ í˜„ì¬ ë§ˆì»¤ë¡œ ì €ì¥
                currentMarker = marker;

                // ì²« ë²ˆì§¸ ìœ„ì¹˜ í™•ì¸ì´ê±°ë‚˜ ìœ„ì¹˜ê°€ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì§€ë„ì˜ ì¤‘ì‹¬ì„ í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™
                if (isFirstLocation || (latitude !== lastPosition.lat || longitude !== lastPosition.lng)) {
                    map.setCenter(markerOptions.position);
                    isFirstLocation = false; // ì²« ë²ˆì§¸ ìœ„ì¹˜ í™•ì¸ì´ ëë‚¬ìœ¼ë¯€ë¡œ falseë¡œ ì„¤ì •
                }
                });
            }, 2000);
        </script>

    </main>
